<!--pages/fruit-compare/fruit-compare.wxml-->

<view class="container">
  <!-- 对比水果列表 -->
  <view class="comparison-list card">
    <scroll-view class="scroll-container" scroll-x="true">
      <view class="fruit-items">
        <view class="fruit-item" wx:for="{{comparisonFruits}}" wx:key="id">
          <image class="fruit-image" src="{{item.image}}" lazy-load="true"></image>
          <text class="fruit-name">{{item.name}}</text>
          <text class="fruit-price">{{item.price}}</text>
          <button class="remove-btn" bindtap="removeFruit" data-id="{{item.id}}">
            <text class="icon-remove">&#10005;</text>
            <text class="btn-text">移除</text>
          </button>
        </view>
        <view class="add-more" bindtap="addMoreFruits">
          <view class="add-icon">
            <text class="icon-plus">&#10133;</text>
          </view>
          <text class="add-text">添加水果</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- 对比维度切换 -->
  <view class="dimension-tabs card mb-30">
    <view class="tab-item {{activeDimension === 'basic' ? 'active' : ''}}" data-dimension="basic" bindtap="switchDimension">
      基础信息
    </view>
    <view class="tab-item {{activeDimension === 'nutrition' ? 'active' : ''}}" data-dimension="nutrition" bindtap="switchDimension">
      营养成分
    </view>
    <view class="tab-item {{activeDimension === 'price' ? 'active' : ''}}" data-dimension="price" bindtap="switchDimension">
      价格趋势
    </view>
    <view class="tab-item {{activeDimension === 'taste' ? 'active' : ''}}" data-dimension="taste" bindtap="switchDimension">
      口感特征
    </view>
    <view class="tab-item {{activeDimension === 'sugar' ? 'active' : ''}}" data-dimension="sugar" bindtap="switchDimension">
      糖酸度
    </view>
  </view>

  <!-- 对比结果总结 -->
  <view class="recommend-summary card" wx:if="{{recommendation}}">
    <text class="title">智能推荐</text>
    <text class="summary-text mt-20">
      {{recommendation.reason}}
    </text>
  </view>

  <!-- 基础信息对比 -->
  <view class="comparison-table card" wx:if="{{activeDimension === 'basic'}}">
    <!-- 表头 -->
    <view class="table-header">
      <view class="header-cell"></view>
      <view class="header-cell" wx:for="{{comparisonFruits}}" wx:key="id">{{item.name}}</view>
    </view>
    
    <!-- 价格对比 -->
    <view class="table-row">
      <view class="row-label">价格</view>
      <view class="row-cell" wx:for="{{priceData}}" wx:key="index">
        <text class="value {{item.isBest ? 'best' : ''}}">{{item.value}}</text>
        <text class="tag" wx:if="{{item.isBest}}">最优</text>
      </view>
    </view>
    
    <!-- 甜度对比 -->
    <view class="table-row">
      <view class="row-label">甜度</view>
      <view class="row-cell" wx:for="{{sweetnessData}}" wx:key="index">
        <text class="value {{item.isBest ? 'best' : ''}}">{{item.value}}</text>
        <text class="tag" wx:if="{{item.isBest}}">最甜</text>
      </view>
    </view>
    
    <!-- 水分对比 -->
    <view class="table-row">
      <view class="row-label">水分</view>
      <view class="row-cell" wx:for="{{waterData}}" wx:key="index">
        <text class="value {{item.isBest ? 'best' : ''}}">{{item.value}}</text>
        <text class="tag" wx:if="{{item.isBest}}">最高</text>
      </view>
    </view>
    
    <!-- 热量对比 -->
    <view class="table-row">
      <view class="row-label">热量</view>
      <view class="row-cell" wx:for="{{calorieData}}" wx:key="index">
        <text class="value {{item.isBest ? 'best' : ''}}">{{item.value}}</text>
        <text class="tag" wx:if="{{item.isBest}}">最低</text>
      </view>
    </view>
    
    <!-- 维生素C对比 -->
    <view class="table-row">
      <view class="row-label">维生素C</view>
      <view class="row-cell" wx:for="{{vitaminCData}}" wx:key="index">
        <text class="value {{item.isBest ? 'best' : ''}}">{{item.value}}</text>
        <text class="tag" wx:if="{{item.isBest}}">最高</text>
      </view>
    </view>
    
    <!-- 口感评分 -->
    <view class="table-row">
      <view class="row-label">口感评分</view>
      <view class="row-cell" wx:for="{{tasteData}}" wx:key="index">
        <view class="stars">
          <text class="star {{item.filled >= 1 ? 'filled' : ''}}">&#9733;</text>
          <text class="star {{item.filled >= 2 ? 'filled' : ''}}">&#9733;</text>
          <text class="star {{item.filled >= 3 ? 'filled' : ''}}">&#9733;</text>
          <text class="star {{item.filled >= 4 ? 'filled' : ''}}">&#9733;</text>
          <text class="star {{item.filled >= 5 ? 'filled' : ''}}">&#9733;</text>
        </view>
        <text class="score">{{item.score}}</text>
      </view>
    </view>
  </view>

  <!-- 营养成分可视化 -->
  <view class="visualization card" wx:if="{{activeDimension === 'nutrition' && nutritionData && chartsLoaded}}">
    <view class="chart-header">
      <text class="title">营养成分对比（雷达图）</text>
      <button class="export-btn" bindtap="exportChart" data-type="radar">导出图片</button>
    </view>
    <canvas class="chart-canvas" id="radarChart" canvas-id="radarChart"></canvas>
  </view>
  
  <!-- 价格趋势可视化 -->
  <view class="visualization card" wx:if="{{activeDimension === 'price' && priceData && chartsLoaded}}">
    <view class="chart-header">
      <text class="title">价格趋势对比（折线图）</text>
      <button class="export-btn" bindtap="exportChart" data-type="line">导出图片</button>
    </view>
    <canvas class="chart-canvas" id="lineChart" canvas-id="lineChart"></canvas>
  </view>
  
  <!-- 口感特征可视化 -->
  <view class="visualization card" wx:if="{{activeDimension === 'taste' && tasteData && chartsLoaded}}">
    <view class="chart-header">
      <text class="title">口感特征对比（标签云）</text>
      <button class="export-btn" bindtap="exportChart" data-type="tagcloud">导出图片</button>
    </view>
    <canvas class="chart-canvas" id="tagCloud" canvas-id="tagCloud"></canvas>
  </view>
  
  <!-- 糖酸度可视化 -->
  <view class="visualization card" wx:if="{{activeDimension === 'sugar' && sugarData && chartsLoaded}}">
    <view class="chart-header">
      <text class="title">糖酸度对比（柱状图）</text>
      <button class="export-btn" bindtap="exportChart" data-type="bar">导出图片</button>
    </view>
    <canvas class="chart-canvas" id="barChart" canvas-id="barChart"></canvas>
  </view>
  
  <!-- 图表骨架屏 -->
  <view class="visualization card" wx:if="{{loading && activeDimension !== 'basic'}}">
    <text class="title mb-30">数据加载中...</text>
    <view class="skeleton-chart"></view>
  </view>
  
  <!-- 空状态 -->
  <view class="empty-state card" wx:if="{{comparisonFruits.length === 0}}">
    <image class="empty-icon" src="/images/icon_empty.png"></image>
    <text class="empty-text">暂无对比数据</text>
    <button class="add-btn" bindtap="addMoreFruits">添加水果</button>
  </view>
</view>